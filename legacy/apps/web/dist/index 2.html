<!DOCTYPE html><html lang="en" data-astro-cid-j7pv25f6> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>TX Well Lookup</title><base href="/"><style>:root{--ink:#0b0b0c;--bg:#f6f7f9;--card:#fff;--muted:#6b7280}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}header[data-astro-cid-j7pv25f6]{position:sticky;top:0;background:var(--card);border-bottom:1px solid #e5e7eb}.wrap[data-astro-cid-j7pv25f6]{max-width:1000px;margin:0 auto;padding:16px}.btn[data-astro-cid-j7pv25f6]{background:#111;color:#fff;border-radius:10px;padding:10px 14px;text-decoration:none}.card[data-astro-cid-j7pv25f6]{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:18px}.grid[data-astro-cid-j7pv25f6]{display:grid;gap:16px;grid-template-columns:1fr}@media (min-width:960px){.grid[data-astro-cid-j7pv25f6]{grid-template-columns:320px 1fr}}small[data-astro-cid-j7pv25f6]{color:var(--muted)}code[data-astro-cid-j7pv25f6]{background:#f3f4f6;padding:2px 6px;border-radius:6px}
</style><script type="module" src="/_astro/hoisted.b0VIpmVD.js"></script></head> <body data-astro-cid-j7pv25f6> <script>
      window.__tx_api = "{apiUrl}";
    </script> <header data-astro-cid-j7pv25f6> <div class="wrap" style="display:flex;gap:12px;align-items:center;" data-astro-cid-j7pv25f6> <strong data-astro-cid-j7pv25f6>TX Well Lookup</strong> <span style="color:var(--muted)" data-astro-cid-j7pv25f6>starter static site</span> <nav style="margin-left:auto;display:flex;gap:12px;align-items:center;" data-astro-cid-j7pv25f6> <a href="/" data-astro-cid-j7pv25f6>Home</a> <a href="/about/" data-astro-cid-j7pv25f6>About</a> <a class="btn" href="https://github.com/" rel="noreferrer" data-astro-cid-j7pv25f6>GitHub</a> </nav> </div> </header> <main class="wrap" style="padding-block:24px" data-astro-cid-j7pv25f6> <div class="grid" data-astro-cid-j7pv25f6> <section class="card"> <h1>TX Well Lookup</h1> <p>Find water wells in Texas and see nearby energy activity. Built from SDR, GWDB, and RRC datasets.</p> <p><a class="btn" href="/about/">About the project</a></p> </section> <section class="card"> <h3>API status</h3> <p id="api-status" style="margin:0"><small>API: checking…</small></p> <script>
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 1500);
    fetch('health', { signal: controller.signal, cache: 'no-store' })
      .then((r) => r.ok ? r.json().catch(() => ({ ok: false })) : { ok: false })
      .then((data) => {
        const el = document.getElementById('api-status');
        if (!el) return;
        const ok = Boolean(data && data.ok);
        el.innerHTML = `<small>API: ${ok ? 'ok' : 'offline'}</small>`;
      })
      .catch(() => {
        const el = document.getElementById('api-status');
        if (!el) return;
        el.innerHTML = '<small>API: offline</small>';
      })
      .finally(() => clearTimeout(timeout));
  </script> </section> <section class="card" data-api=""> <h3 style="margin-top:0">Search</h3> <form id="search-form" style="display:flex;flex-wrap:wrap;gap:8px;align-items:center"> <input id="q" name="q" placeholder="Search wells (try: Sample)" style="flex:1 1 220px;min-width:200px;padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb"> <input id="depthMin" name="depthMin" type="number" placeholder="Min depth (ft)" style="flex:0 0 160px;padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb"> <input id="depthMax" name="depthMax" type="number" placeholder="Max depth (ft)" style="flex:0 0 160px;padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb"> <button class="btn" type="submit" style="flex:0 0 auto">Search</button> </form> <div id="results" style="margin-top:12px"></div> <script>
    const form = document.getElementById('search-form');
    const container = document.currentScript.closest('section');
    const results = document.getElementById('results');
    const inputQ = document.getElementById('q');
    const inputMin = document.getElementById('depthMin');
    const inputMax = document.getElementById('depthMax');
    let currentItems = [];
    const setStatus = (msg) => {
      results.innerHTML = `<small>${msg}</small>`;
    };
    async function fetchItems() {
      try {
        const apiBase = (container?.dataset.api || '').toString().trim();
        const primary = apiBase
          ? new URL('v1/search', apiBase.endsWith('/') ? apiBase : apiBase + '/').toString()
          : new URL('/v1/search', window.location.origin).toString();
        let res = await fetch(primary, { cache: 'no-store' });
        if (!res.ok) {
          // Fallback to static stub when API/proxy is unavailable
          const stub = new URL('api/search.json', document.baseURI).toString();
          res = await fetch(stub, { cache: 'no-store' });
        }
        if (!res.ok) throw new Error('bad status');
        const data = await res.json();
        const items = Array.isArray(data.items) ? data.items : Array.isArray(data) ? data : [];
        return items;
      } catch (err) {
        console.error('search fetch failed', err);
        return [];
      }
    }
    function applyFilters(items) {
      const q = (document.getElementById('q').value || '').toLowerCase();
      const depthMin = parseFloat(document.getElementById('depthMin').value || '');
      const depthMax = parseFloat(document.getElementById('depthMax').value || '');
      return items.filter((it) => {
        const matchesQ = !q || `${it.name} ${it.county}`.toLowerCase().includes(q);
        const matchesMin = isNaN(depthMin) || (it.depth_ft ?? 0) >= depthMin;
        const matchesMax = isNaN(depthMax) || (it.depth_ft ?? 0) <= depthMax;
        return matchesQ && matchesMin && matchesMax;
      });
    }
    function ensureMap(items) {
      if (window.__tx_map) {
        window.__tx_map.setItems(items);
        return;
      }
      const onReady = () => {
        window.__tx_map?.setItems(items);
        window.removeEventListener('tx_map_ready', onReady);
      };
      window.addEventListener('tx_map_ready', onReady);
    }
    function render(items) {
      items = applyFilters(items);
      if (!items.length) {
        setStatus('No results.');
        ensureMap([]);
        return;
      }
      const ul = document.createElement('ul');
      ul.style.listStyle = 'none';
      ul.style.padding = '0';
      ul.style.margin = '0';
      items.forEach((it) => {
        const li = document.createElement('li');
        li.style.padding = '10px 0';
        li.style.borderBottom = '1px solid #eee';
        const gwdb = it.gwdb_depth_ft ? `<span class="chip" style="background:#ecfeff;border:1px solid #a5f3fc;color:#083344;border-radius:999px;padding:2px 8px;margin-left:6px;font-size:11px">GWDB</span>` : '';
        li.innerHTML = `
          <strong><a href="well/${it.id}/">${it.name}</a></strong>
          ${gwdb}
          <div><small>${it.county} County • Depth: ${it.depth_ft} ft${it.gwdb_depth_ft ? ` • GWDB: ${it.gwdb_depth_ft} ft` : ''}${it.aquifer ? ` • Aquifer: ${it.aquifer}` : ''}${it.gcd ? ` • GCD: ${it.gcd}` : ''}</small></div>
          <div style="margin-top:6px"><button data-id="${it.id}" class="btn" style="padding:6px 10px">Fly to</button></div>
        `;
        ul.appendChild(li);
      });
      results.innerHTML = '';
      results.appendChild(ul);
      results.querySelectorAll('button[data-id]').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const id = btn.getAttribute('data-id');
          window.__tx_map?.flyToItem(id);
        });
      });
      ensureMap(items);
    }
    // initial load and on submit
    setStatus('Loading…');
    fetchItems().then((items) => { currentItems = items; render(items); ensureMap(items); });
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setStatus('Searching…');
      const items = await fetchItems();
      currentItems = items;
      render(items);
    });

    // live filter as you type/change
    const onFilterChange = () => render(currentItems);
    inputQ.addEventListener('input', onFilterChange);
    inputMin.addEventListener('input', onFilterChange);
    inputMax.addEventListener('input', onFilterChange);
  </script> </section> <section class="card"> <h3 style="margin-top:0">Map</h3> <div id="map" style="height:360px;border-radius:12px;overflow:hidden;min-height:280px"></div> <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">  <script>
    (function(){
      const container = document.getElementById('map');
      if (!container) return;
      function init(){
        if (!window.maplibregl) { setTimeout(init, 100); return; }
        const map = new maplibregl.Map({
          container: container,
          style: 'https://demotiles.maplibre.org/style.json',
          center: [-99.0, 31.0],
          zoom: 5.5
        });
        map.addControl(new maplibregl.NavigationControl(), 'top-right');
        const wellsSourceId = 'wells-src';
        const wellsLayerId = 'wells-layer';
        const featuresById = new Map();
        map.on('load', () => {
          map.addSource(wellsSourceId, { type: 'geojson', data: { type:'FeatureCollection', features: [] } });
          map.addLayer({
            id: wellsLayerId,
            type: 'circle',
            source: wellsSourceId,
            paint: {
              'circle-radius': 5,
              'circle-color': '#2563eb',
              'circle-stroke-width': 1,
              'circle-stroke-color': '#ffffff'
            }
          });
        });
        function setItems(items){
          const fc = { type:'FeatureCollection', features: [] };
          featuresById.clear();
          items.forEach(it => {
            const f = { type:'Feature', geometry:{ type:'Point', coordinates:[it.lon, it.lat] }, properties:{ id: it.id, name: it.name, county: it.county } };
            fc.features.push(f);
            featuresById.set(it.id, f);
          });
          const src = map.getSource(wellsSourceId);
          if (src) src.setData(fc);
          if (fc.features.length){
            const bounds = new maplibregl.LngLatBounds();
            fc.features.forEach(f => bounds.extend(f.geometry.coordinates));
            map.fitBounds(bounds, { padding: 40, duration: 600 });
          }
        }
        function flyToItem(id){
          const f = featuresById.get(id);
          if (!f) return;
          const [lon, lat] = f.geometry.coordinates;
          map.flyTo({ center:[lon, lat], zoom: Math.max(map.getZoom(), 12), duration: 600 });
        }
        window.__tx_map = { setItems, flyToItem };
        window.dispatchEvent(new CustomEvent('tx_map_ready'));
      }
      init();
    })();
  </script> </section> <section class="card" data-astro-cid-j7pv25f6> <h3 data-astro-cid-j7pv25f6>What’s next</h3> <ol data-astro-cid-j7pv25f6> <li data-astro-cid-j7pv25f6>Read <code data-astro-cid-j7pv25f6>docs/sprints/sprint1_static_to_foundation.md</code> and execute Agent C tasks.</li> <li data-astro-cid-j7pv25f6>Follow Sprint 2 to add the API shell; Sprint 3 brings search & map.</li> </ol> </section> </div> </main> </body></html>