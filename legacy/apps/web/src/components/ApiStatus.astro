---
const publicApi = import.meta.env.PUBLIC_API_URL || '';
---
<section class="card" data-api={publicApi}>
  <h3>API status</h3>
  <p id="api-status" style="margin:0"><small>API: checkingâ€¦</small></p>
  <script is:inline>
    (function(){
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 2000);
      const container = document.currentScript.closest('section');
      const apiBase = (container?.dataset.api || '').toString().trim();
      const el = document.getElementById('api-status');
      if (!el) { clearTimeout(timeout); return; }
      const isValid = /^https?:\/\//i.test(apiBase);
      if (!apiBase || !isValid) { el.innerHTML = '<small>API: not configured</small>'; clearTimeout(timeout); return; }
      const url = new URL('health', apiBase.endsWith('/') ? apiBase : apiBase + '/').toString();
      fetch(url, { signal: controller.signal, cache: 'no-store' })
        .then((r) => r.ok ? r.json().catch(() => ({ ok: false })) : { ok: false })
        .then((data) => {
          const ok = Boolean(data && data.ok);
          el.innerHTML = `<small>API: ${ok ? 'ok' : 'offline'}</small>`;
        })
        .catch(() => {
          el.innerHTML = '<small>API: offline</small>';
        })
        .finally(() => clearTimeout(timeout));
    })();
  </script>
</section>


